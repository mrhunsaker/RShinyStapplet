<!DOCTYPE HTML>
<HTML>
    <HEAD>
        <TITLE>SRiS Applet Preferences</TITLE>
        <LINK REL="stylesheet" TYPE="text/css" HREF="./master.css">
        <SCRIPT SRC="./utility.js"></SCRIPT>
        <SCRIPT SRC="./prefs_format.js"></SCRIPT>
        <SCRIPT SRC="./simple_validate.js"></SCRIPT>
        <SCRIPT SRC="./ui_handlers.js"></SCRIPT>
        <SCRIPT><!--
        function paintSwatch(canvasID, color)
        {
            var context = document.getElementById(canvasID).getContext("2d");
            context.fillStyle = color;
            context.fillRect(0, 0, context.canvas.width, context.canvas.height);
        }
        
        function updateExamples()
        {
            document.getElementById("spnNumEx1").innerHTML = formatNumber(31.4159);
            document.getElementById("spnNumEx2").innerHTML = formatNumber(1/7);
            document.getElementById("spnNumEx3").innerHTML = formatNumber((-21.3));
            document.getElementById("spnPropEx").innerHTML = formatProportion(0.314);

            if (canvasSupported())
            {
                paintSwatch("cnvDotplotBGColor", PREF_DOTPLOT_BACKGROUND_COLOR);            
                paintSwatch("cnvDotplotDotColor", PREF_DOTPLOT_DOT_COLOR);            
                var dotcontext = document.getElementById("cnvDotplotDotColor").getContext("2d");
            }
        }

        function initializePreferences()
        {
            for (var i = 1; i <= 2; i++)
            {
                var rdButton = document.getElementById("rdPropDisplay" + i);
                if (rdButton.value == PREF_PROP_DISPLAY_TYPE)
                    rdButton.checked = true;
            }
            
            for (var i = 1; i <= 3; i++)
            {
                var rdButton = document.getElementById("rdNumRounding" + i);
                if (rdButton.value == PREF_NUM_ROUNDING_TYPE)
                    rdButton.checked = true;
            }

            document.getElementById("txtNumAutoPlaces").value = PREF_NUM_ROUNDING_AUTO_PLACES;
            document.getElementById("txtNumFixedPlaces").value = PREF_NUM_ROUNDING_FIXED_PLACES;
            document.getElementById("txtNumPrecision").value = PREF_NUM_ROUNDING_PRECISION;
            document.getElementById("txtPropPlaces").value = PREF_PROP_DISPLAY_PLACES;

            if (canvasSupported())
            {
                document.getElementById("chkDotplotBin").checked = PREF_DOTPLOT_BIN;
                document.getElementById("selDotplotBGColor").value = PREF_DOTPLOT_BACKGROUND_COLOR;
                document.getElementById("selDotplotDotColor").value = PREF_DOTPLOT_DOT_COLOR;
            }
            
            updateExamples();
        }

        function writeNumberRoundingPreferences(rdButton)
        {
            writePreference(PREF_KEY_NUM_ROUNDING_TYPE, rdButton.value);
            if (validateInputInt("txtNumAutoPlaces", 0, 20, false, "spnNumAutoPlacesMsg"))
                writePreference(PREF_KEY_NUM_ROUNDING_AUTO_PLACES, document.getElementById("txtNumAutoPlaces").value);
            if (validateInputInt("txtNumFixedPlaces", 0, 20, false, "spnNumFixedPlacesMsg"))
                writePreference(PREF_KEY_NUM_ROUNDING_FIXED_PLACES, document.getElementById("txtNumFixedPlaces").value);
            if (validateInputInt("txtNumPrecision", 1, 21, false, "spnNumPrecisionMsg"))
                writePreference(PREF_KEY_NUM_ROUNDING_PRECISION, document.getElementById("txtNumPrecision").value);
                
            loadPreferences();
            updateExamples();
        }
        
        function writePropDisplayPreferences(rdButton)
        {
            if (rdButton)
                writePreference(PREF_KEY_PROP_DISPLAY_TYPE, rdButton.value);
            if (validateInputInt("txtPropPlaces", 1, PREF_ZERO_TOLERANCE_PLACES, false, "spnPropPlacesMsg"))
                writePreference(PREF_KEY_PROP_DISPLAY_PLACES, document.getElementById("txtPropPlaces").value);

            loadPreferences();
            updateExamples();
        }
        
        function writeDotPlotColorPreferences()
        {
            var bgcolor = document.getElementById("selDotplotBGColor").value;
            var dotcolor = document.getElementById("selDotplotDotColor").value;
            writePreference(PREF_KEY_DOTPLOT_BACKGROUND_COLOR, bgcolor);
            writePreference(PREF_KEY_DOTPLOT_DOT_COLOR, dotcolor);
            
            loadPreferences();
            updateExamples();
        }

        function selectRadio(radioID)
        {
            document.getElementById(radioID).click();
        }

        function resetPreferences()
        {
            writeDefaultPreferences();
            loadPreferences();
            initializePreferences();
        }

        function pageLoaded()
        {
            initializePreferences();
            var browserMsg = "";
            if (!storageSupported())
            {
                if (!navigator.cookieEnabled)
                    browserMsg += "You must enable cookies in order to allow preferences to be saved.<BR>";
            }
            if (!canvasSupported())
            {
                ui_removeElement("spnDotplotPrefs");
                browserMsg += "Your browser does not support the graphing features of this program. Please consider using an updated browser.";
            }
            document.getElementById("spnBrowserMsg").innerHTML = browserMsg;
        }

        ui_setOnLoad(pageLoaded);
//--></SCRIPT>
    </HEAD>
    <BODY>
        <SPAN CLASS="message" id="spnBrowserMsg"></SPAN>
        <H1>SRiS Applet Preferences</H1>
        <P>All preferences are saved as soon as you change them, but changes will not affect any open windows or tabs.</P>
        <FORM>
            <P><B>Rounding/Display of Proportions</B><BR>
            Display proportions as: 
            <INPUT TYPE="radio" ID="rdPropDisplay1" NAME="rdPropDisplay" VALUE="proportion" onClick="writePropDisplayPreferences(this)">decimals</INPUT>
            <INPUT TYPE="radio" ID="rdPropDisplay2" NAME="rdPropDisplay" VALUE="percent" onClick="writePropDisplayPreferences(this)">percentages</INPUT><BR>
            Keep up to <INPUT TYPE="text" ID="txtPropPlaces" SIZE="3" onChange="writePropDisplayPreferences()"> digit(s) of precision <SPAN CLASS="message" ID="spnPropPlacesMsg"></SPAN>
            <BR><BR>
            <B>Example:</B> 0.314 = <SPAN ID="spnPropEx"></SPAN>
            </P>
            <P><B>Rounding of Numbers</B><BR>
            <INPUT TYPE="radio" ID="rdNumRounding1" NAME="rdNumRounding" VALUE="auto" onClick="writeNumberRoundingPreferences(this)">Round to as many as
                <INPUT TYPE="text" ID="txtNumAutoPlaces" onChange="selectRadio('rdNumRounding1')" SIZE="3"> decimal place(s)
            <SPAN CLASS="message" ID="spnNumAutoPlacesMsg"></SPAN><BR>
            <INPUT TYPE="radio" ID="rdNumRounding2" NAME="rdNumRounding" VALUE="fixed" onClick="writeNumberRoundingPreferences(this)">Always round to
                <INPUT TYPE="text" ID="txtNumFixedPlaces" onChange="selectRadio('rdNumRounding2')" SIZE="3"> decimal place(s)
            <SPAN CLASS="message" ID="spnNumFixedPlacesMsg"></SPAN><BR>
            <INPUT TYPE="radio" ID="rdNumRounding3" NAME="rdNumRounding" VALUE="precision" onClick="writeNumberRoundingPreferences(this)">Always round to
                <INPUT TYPE="text" ID="txtNumPrecision" onChange="selectRadio('rdNumRounding3')" SIZE="3"> significant figure(s)
            <SPAN CLASS="message" ID="spnNumPrecisionMsg"></SPAN>
            <BR><BR>
            <B>Examples:</B> 31.4159 = <SPAN ID="spnNumEx1"></SPAN>, 1/7 = <SPAN ID="spnNumEx2"></SPAN>, -21.3 = <SPAN ID="spnNumEx3"></SPAN>
            </P>
            <SPAN ID="spnDotplotPrefs">
            <P><B>Plots</B><BR>
            <INPUT TYPE="checkbox" ID="chkDotplotBin" NAME="chkDotplotBin" onChange="writePreference(PREF_KEY_DOTPLOT_BIN, '' + this.checked)">Minimize horizontal overlap on dot plots
            in exchange for exact dot accuracy
            <TABLE>
            <TR><TD CLASS="noborder">Background color for plots:</TD>
            <TD CLASS="noborder"><SELECT ID="selDotplotBGColor" onChange="writeDotPlotColorPreferences()">
                <OPTION VALUE="#FFFFFF">White</OPTION>
                <OPTION VALUE="#CCCCCC">Light Gray</OPTION>
                <OPTION VALUE="#FFFFCC">Light Yellow</OPTION>
                <OPTION VALUE="#FFCCCC">Peach</OPTION>
                <OPTION VALUE="#FF99FF">Chartreuse</OPTION>
                <OPTION VALUE="#CCFFCC">Teal</OPTION>
            </SELECT></TD>
            <TD CLASS="noborder"><CANVAS CLASS="swatch" ID="cnvDotplotBGColor" WIDTH="50" HEIGHT="8"></CANVAS></TD></TR>
            <TR><TD CLASS="noborder">Dot color for plot:</TD>
            <TD CLASS="noborder"><SELECT ID="selDotplotDotColor" onChange="writeDotPlotColorPreferences()">
                <OPTION VALUE="#993399">Purple</OPTION>                
                <OPTION VALUE="#FF3333">Red</OPTION>                
                <OPTION VALUE="#33CC33">Green</OPTION>
                <OPTION VALUE="#3333FF">Blue</OPTION>
                <OPTION VALUE="#000000">Black</OPTION>                
            </SELECT></TD>
            <TD CLASS="noborder"><CANVAS CLASS="swatch" ID="cnvDotplotDotColor" WIDTH="50" HEIGHT="8"></CANVAS></TD></TR>
            </TABLE></P></SPAN>
            <P><INPUT TYPE="button" ID="btnReset" VALUE="Reset all preferences to default" onClick="resetPreferences()"></P>
        </FORM>
    </BODY>
</HTML>